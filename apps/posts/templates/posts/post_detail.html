{% extends 'posts/base.html' %}
{% load static %}
{% load custom_filters %}

    <title>{{ post.title }}</title>
    {% block link %}<link rel="stylesheet" href="{% static 'posts/css/post_detail.css' %}">
    <link rel="stylesheet" href="{% static 'posts/css/styles.css' %}?v=3">{% endblock %}

{% block body %}
    <div class="posts-container">
        <div class="post-wrapper">
            <div class="posts">
                <div class="user-photo-name">
                    <div class="user">
                        <img src="{{ post.user.image.url }}">
                        <div class="name-and-date-category">
                            <div class="username-and-follows">
                                <div class="username">
                                    <a href="{% url 'profile' post.user.username %}">{{ post.user.username }}</a>
                                    <span style="color: gray;">{{ post.pub_date|smart_time }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% if request.user != post.user %}
                        <div class="follow-btn" onclick="followFunc(this)" data-id="{{ post.user.id }}">Подписаться</div>
                    {% endif %}
                </div>
                <br>
                    <div class="post-meta">
                        <a href="{% url 'category' post.category %}" class="post_category">{{ post.category }}</a>
                        <div class="post-type">{{ post.post_type }}</div>
                    </div>
                <br>
                <br>
                <div class="title">
                    <a>{{ post.title }}</a>
                </div>
                <br>
                <div class="ql-editor">
                    {% if post.wrapp_img %}
                       <img src="{{ post.wrapp_img.url }}" alt="" class="wrapp_img">
                    {% endif %}
                    <p>{{ post.content|safe }}</p>
                </div>
                <div class="icon-cont">
                    <div class="post-reactions">
                        <div class="like-wrapper" id="wrapper-id" onclick="setPostLike(this)" data-id="{{ post.id }}">
                            <img src="/media/icons/hart.png" class="heart-img" id="like-button">
                            <span class="likes-count" id="likes-count-{{ post.id }}">{{ post.liked_by.count }}</span>
                        </div>
                        <div class="comment-wrapper">
                            <a href="{% url 'post_detail' post.id %}">
                                <img src="/media/icons/comment.svg" class="comment-img">
                            </a>
                            <span class="comment-count">{{ post.update_comment_count }}</span>
                        </div>
                        <div class="bookmark-wrapper" onclick="setPostBookmark(this)" data-id="{{ post.id }}" data-section="bookmarks">
                            <a>
                                <svg class="bookmark-img" width="24" height="24" viewBox="0 0 24 24">
                                    <path d="M6 2C5.44772 2 5 2.44772 5 3V21C5 21.2761 5.22386 21.5 5.5 21.5C5.63261 21.5 5.76522 21.4477 5.85355 21.3536L12 15.7071L18.1464 21.3536C18.2348 21.4477 18.3674 21.5 18.5 21.5C18.7761 21.5 19 21.2761 19 21V3C19 2.44772 18.5523 2 18 2H6Z" stroke-width="2"/>
                                </svg>
                            </a>
                            <span class="bookmark-count" id="bookmark-count-{{ post.id }}">{{ post.bookmark_user.count }}</span>
                        </div>
                    </div>
                    <div class="view-wrapper">
                        <img src="/media/icons/view.svg" class="views-img">
                        <span class="views-count">{{ post.views_count }}</span>
                    </div>
                </div>
            </div>
            <div class="comments">
                <div class="comments-title">Все комментарии</div>
                {% if request.user != 'AnonymousUser' %}
                    <div class="send_comment__form" id="send_comment__form-{{ post.id }}">
                        <textarea id="comment-{{ post.id }}" class="comment-input" placeholder="Комментарий"></textarea>
                        <div class="send-comment" onclick="sendComment(this)" data-id="{{ post.id }}" data-field-id="{{ post.id }}">Отправить</div>
                    </div>
                {% else %}
                    <span>Зарегестрируйтесь, что бы отправить комментарий.</span>
                {% endif %}
                <div class="comments-container"></div>
            </div>
        </div>
    </div>
    <script>
        const postID = '{{ post.id }}'
        const currentUser = '{{ request.user }}'
    </script>
{% endblock %}